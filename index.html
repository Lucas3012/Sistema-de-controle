<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle de Estoque</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos Comuns */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f0f2f5;
        }

        /* ------------------- Estilos da Tela de Login ------------------- */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .login-box {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 300px;
            text-align: center;
        }
        .login-box h2 {
            margin-bottom: 24px;
            color: #333;
        }
        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: ff0000;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-btn:hover {
            background-color: #0056b3;
        }
        .logo-image-login {
            max-width: 150px;
            margin-bottom: 20px;
        }

        /* ------------------- Estilos do Dashboard ------------------- */
        .dashboard-container {
            display: none;
            flex-direction: column;
        }
        /* Estilos da barra de navegação superior */
        .top-nav {
            background-color: #2c3e50;
            color: #ecf0f1;
            display: flex;
            justify-content: space-between; /* Altera a distribuição dos itens */
            align-items: center;
            padding: 0 20px;
        }
        .top-nav h2 {
            color: #ecf0f1;
            flex-grow: 1; /* Permite que o título ocupe o espaço restante */
            text-align: center; /* Centraliza o texto dentro do h2 */
            margin: 0; /* Remove a margem para melhor centralização */
            padding: 15px 0;
            font-size: 24px;
            font-weight: bold;
        }
        .nav-links {
            display: flex;
        }
        .top-nav a {
            color: #ecf0f1;
            text-decoration: none;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            text-align: center;
            transition: background-color 0.3s;
        }
        .top-nav a i {
            margin-right: 8px;
        }
        /* Estilos para a navegação superior ativa */
        .top-nav a.active {
            background-color: #34495e;
            border-bottom: 3px solid #007bff;
        }
        .top-nav a:hover {
            background-color: #34495e;
        }

        .main-content {
            padding: 20px;
        }
        .main-content h1 {
            color: #34495e;
            margin-bottom: 20px;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .action-buttons button {
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            color: #fff;
            transition: background-color 0.3s;
        }
        .btn-entrada {
            background-color: #2ecc71;
        }
        .btn-entrada:hover {
            background-color: #27ae60;
        }
        .btn-saida {
            background-color: #e74c3c;
        }
        .btn-saida:hover {
            background-color: #c0392b;
        }
        .form-section {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .produtos-container .form-section {
            max-width: 1000px;
        }

        /* Estilos das tabelas */
        .product-list-section, .history-section, .cat-sup-section {
            overflow-x: auto;
        }
        .product-list-section table,
        .history-section table,
        .cat-sup-section table {
            width: 100%;
            min-width: 300px;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .product-list-section th, .product-list-section td,
        .history-section th, .history-section td,
        .cat-sup-section th, .cat-sup-section td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .product-list-section th, .history-section th, .cat-sup-section th {
            background-color: #f4f4f4;
            font-weight: bold;
        }
        .product-list-section .action-buttons {
            margin-top: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .product-list-section .action-buttons .btn {
            padding: 5px 10px;
            font-size: 14px;
        }
        .product-list-section .action-buttons .btn-excluir {
            background-color: #e74c3c;
        }
        .product-list-section .action-buttons .btn-excluir:hover {
            background-color: #c0392b;
        }
        /* Alerta de Estoque Mínimo */
        .low-stock {
            background-color: #fce7e7;
            color: #c0392b;
            font-weight: bold;
        }
        
        /* ------------------- Estilos dos Pop-ups customizados ------------------- */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .popup-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            width: 400px;
            max-width: 90%;
            text-align: center;
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            animation: popup-zoom-in 0.3s forwards;
        }
        @keyframes popup-zoom-in {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        .popup-content h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .popup-content .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #aaa;
            transition: color 0.3s;
        }
        .popup-content .close-btn:hover {
            color: #555;
        }
        .popup-content form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        .popup-content form .input-group {
            margin-bottom: 0;
        }
        .popup-content form button {
            padding: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #fff;
            transition: background-color 0.3s;
        }
        .popup-content .btn-confirmar {
            background-color: #2ecc71;
        }
        .popup-content .btn-confirmar:hover {
            background-color: #27ae60;
        }

        /* ------------------- Barra de navegação inferior ------------------- */
        .bottom-nav-bar {
            display: none; /* Esconde por padrão para telas grandes */
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #2c3e50;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
            z-index: 999;
            padding: 5px 0;
        }
        .bottom-nav-bar a {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #ecf0f1;
            font-size: 12px;
            padding: 8px 0;
            transition: color 0.3s, background-color 0.3s;
        }
        .bottom-nav-bar a i {
            font-size: 20px;
            margin-bottom: 4px;
        }
        .bottom-nav-bar a:hover,
        .bottom-nav-bar a.active {
            color: #007bff;
        }
        
        .logo-container {
            text-align: center;
            padding: 20px 0;
        }
        .logo-container img {
            max-width: 200px;
            height: auto;
        }

        /* ------------------- Media Queries para Responsividade ------------------- */
        @media (max-width: 768px) {
            .top-nav {
                display: none; /* Esconde a barra superior em telas pequenas */
            }
            .main-content {
                padding-bottom: 70px; /* Adiciona espaço para a barra inferior fixa */
            }
            .bottom-nav-bar {
                display: flex; /* Exibe a barra inferior em telas pequenas */
            }
            .produtos-container .card, .produtos-container .form-section {
                max-width: 100%;
            }
            .action-buttons {
                flex-direction: column;
            }
            .action-buttons button {
                width: 100%;
            }
            .popup-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>

<div id="login-screen" class="login-container">
    <div class="login-box">
        <div class="logo-container">
            <img src="logo.png" alt="Logo EstoqueSys" class="logo-image-login">
        </div>
        <h2>Login</h2>
        <form id="login-form">
            <div class="input-group">
                <label for="username">Usuário</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="input-group">
                <label for="password">Senha</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="login-btn">Entrar</button>
        </form>
    </div>
</div>

<div id="dashboard-screen" class="dashboard-container" style="display: none;">
    <div class="logo-container">
        <img src="logo.png" alt="Logo EstoqueSys">
    </div>

    <div class="top-nav">
        <h2>EstoqueSys</h2>
        <nav class="nav-links">
            <a href="#" class="nav-item" data-tab="relatorios-tab">
                <i class="fa-solid fa-file-lines"></i> Relatórios
            </a>
            <a href="#" class="nav-item" data-tab="dashboard-tab">
                <i class="fa-solid fa-chart-line"></i> Dashboard
            </a>
            <a href="#" class="nav-item" data-tab="historico-tab">
                <i class="fa-solid fa-clock-rotate-left"></i> Histórico
            </a>
            <a href="#" class="nav-item" data-tab="produtos-tab">
                <i class="fa-solid fa-box"></i> Produtos
            </a>
            <a href="#" class="nav-item" data-tab="categorias-fornecedores-tab">
                <i class="fa-solid fa-users"></i> Fornecedores
            </a>
            <a href="#" class="nav-item" data-tab="configuracoes-tab">
                <i class="fa-solid fa-gear"></i> Configurações
            </a>
        </nav>
    </div>

    <div class="main-content">
        <div id="dashboard-tab" class="content-section active">
            <h1>Dashboard</h1>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>Entrada de Produtos</h3>
                    <canvas id="entradaChart"></canvas>
                </div>
                <div class="card">
                    <h3>Saída de Produtos</h3>
                    <canvas id="saidaChart"></canvas>
                </div>
                <div class="card">
                    <h3>Estoque Atual</h3>
                    <canvas id="estoqueChart"></canvas>
                </div>
            </div>
        </div>

        <div id="produtos-tab" class="content-section">
            <h1>Gerenciamento de Produtos</h1>
            <div class="produtos-container">
                <div class="form-section">
                    <h3>Adicionar Novo Produto</h3>
                    <form id="form-adicionar-produto">
                        <div class="input-group">
                            <label for="nome-produto">Nome do Produto</label>
                            <input type="text" id="nome-produto" required>
                        </div>
                         <div class="input-group">
                            <label for="estoque-minimo">Estoque Mínimo</label>
                            <input type="number" id="estoque-minimo" value="0" min="0" required>
                        </div>
                        <button type="submit" class="login-btn">Adicionar Produto</button>
                    </form>
                </div>

                <div class="card">
                    <h3>Ações Rápidas</h3>
                    <div class="action-buttons">
                        <button class="btn-entrada" id="btn-entrada">Entrada de Produto</button>
                        <button class="btn-saida" id="btn-saida">Saída de Produto</button>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Lista de Produtos</h3>
                    <div class="input-group">
                        <label for="search-product">Buscar Produto</label>
                        <input type="text" id="search-product" placeholder="Digite o nome ou código...">
                    </div>
                    <div class="action-buttons">
                        <button class="login-btn" id="filter-all">Todos</button>
                        <button class="btn-saida" id="filter-low-stock">Estoque Mínimo</button>
                    </div>
                    
                    <div class="product-list-section">
                        <table id="product-list-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome do Produto</th>
                                    <th>Quantidade</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="historico-tab" class="content-section">
            <h1>Histórico de Movimentações</h1>
            <div class="form-section history-section">
                <table>
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Produto</th>
                            <th>Ação</th>
                            <th>Quantidade</th>
                        </tr>
                    </thead>
                    <tbody id="history-list-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="categorias-fornecedores-tab" class="content-section">
            <h1>Categorias e Fornecedores</h1>
            <div class="dashboard-grid">
                <div class="form-section cat-sup-section">
                    <h3>Adicionar Categoria</h3>
                    <form id="form-adicionar-categoria">
                        <div class="input-group">
                            <label for="nome-categoria">Nome da Categoria</label>
                            <input type="text" id="nome-categoria" required>
                        </div>
                        <button type="submit" class="login-btn">Adicionar</button>
                    </form>
                    <table>
                        <thead><tr><th>ID</th><th>Nome da Categoria</th></tr></thead>
                        <tbody id="category-list-body"></tbody>
                    </table>
                </div>
                <div class="form-section cat-sup-section">
                    <h3>Adicionar Fornecedor</h3>
                    <form id="form-adicionar-fornecedor">
                        <div class="input-group">
                            <label for="nome-fornecedor">Nome do Fornecedor</label>
                            <input type="text" id="nome-fornecedor" required>
                        </div>
                        <button type="submit" class="login-btn">Adicionar</button>
                    </form>
                    <table>
                        <thead><tr><th>ID</th><th>Nome do Fornecedor</th></tr></thead>
                        <tbody id="supplier-list-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="relatorios-tab" class="content-section">
            <h1>Relatórios</h1>
            <div class="form-section">
                <h3>Gerar Relatório de Estoque</h3>
                <p>Clique no botão abaixo para gerar e baixar um PDF com os dados atuais do estoque.</p>
                <div class="action-buttons">
                    <button class="login-btn" id="btn-baixar-pdf">Baixar PDF</button>
                </div>
            </div>
        </div>

        <div id="configuracoes-tab" class="content-section">
            <h1>Configurações do Sistema</h1>
            <div class="form-section">
                <form id="form-configuracoes">
                    <div class="input-group">
                        <label for="tema-sistema">Tema do Sistema</label>
                        <select id="tema-sistema">
                            <option value="claro">Claro</option>
                            <option value="escuro">Escuro</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="notificacoes">Notificações</label>
                        <input type="checkbox" id="notificacoes" checked>
                    </div>
                    <button type="submit" class="login-btn">Salvar Configurações</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="bottom-nav-bar">
    <a href="#" class="nav-item" data-tab="dashboard-tab">
        <i class="fa-solid fa-chart-line"></i>
        <span>Dashboard</span>
    </a>
    <a href="#" class="nav-item" data-tab="produtos-tab">
        <i class="fa-solid fa-box"></i>
        <span>Produtos</span>
    </a>
    <a href="#" class="nav-item" data-tab="historico-tab">
        <i class="fa-solid fa-clock-rotate-left"></i>
        <span>Histórico</span>
    </a>
    <a href="#" class="nav-item" data-tab="relatorios-tab">
        <i class="fa-solid fa-file-lines"></i>
        <span>Relatórios</span>
    </a>
    <a href="#" class="nav-item" data-tab="configuracoes-tab">
        <i class="fa-solid fa-gear"></i>
        <span>Ajustes</span>
    </a>
</div>

<div id="entrada-popup" class="popup-overlay">
    <div class="popup-content">
        <span class="close-btn" onclick="hidePopup('entrada-popup')">&times;</span>
        <h3>Entrada de Produto</h3>
        <form id="form-entrada">
            <div class="input-group">
                <label for="produto-entrada">Nome do Produto</label>
                <input type="text" id="produto-entrada" required>
            </div>
            <div class="input-group">
                <label for="quantidade-entrada">Quantidade</label>
                <input type="number" id="quantidade-entrada" required>
            </div>
            <button type="submit" class="btn-confirmar">Confirmar Entrada</button>
        </form>
    </div>
</div>

<div id="saida-popup" class="popup-overlay">
    <div class="popup-content">
        <span class="close-btn" onclick="hidePopup('saida-popup')">&times;</span>
        <h3>Saída de Produto</h3>
        <form id="form-saida">
            <div class="input-group">
                <label for="produto-saida">Nome do Produto</label>
                <input type="text" id="produto-saida" required>
            </div>
            <div class="input-group">
                <label for="quantidade-saida">Quantidade</label>
                <input type="number" id="quantidade-saida" required>
            </div>
            <button type="submit" class="btn-confirmar">Confirmar Saída</button>
        </form>
    </div>
</div>

<div id="edicao-popup" class="popup-overlay">
    <div class="popup-content">
        <span class="close-btn" onclick="hidePopup('edicao-popup')">&times;</span>
        <h3>Editar Produto</h3>
        <form id="form-edicao">
            <input type="hidden" id="edit-id">
            <div class="input-group">
                <label for="edit-id-display">ID do Produto</label>
                <input type="text" id="edit-id-display" disabled>
            </div>
            <div class="input-group">
                <label for="edit-codigo-produto">Código</label>
                <input type="text" id="edit-codigo-produto" disabled>
            </div>
            <div class="input-group">
                <label for="edit-nome-produto">Nome do Produto</label>
                <input type="text" id="edit-nome-produto" required>
            </div>
            <div class="input-group">
                <label for="edit-quantidade-produto">Quantidade</label>
                <input type="number" id="edit-quantidade-produto" required>
            </div>
             <div class="input-group">
                <label for="edit-estoque-minimo">Estoque Mínimo</label>
                <input type="number" id="edit-estoque-minimo" required>
            </div>
            <button type="submit" class="btn-confirmar">Salvar Alterações</button>
        </form>
    </div>
</div>

<script>
    // --- Variáveis Globais e LocalStorage ---
    let products = JSON.parse(localStorage.getItem('products')) || [
        { id: 1, codigo: 'PROD-A3D5B', nome: 'Teclado Gamer', quantidade: 50, estoqueMinimo: 10 },
        { id: 2, codigo: 'PROD-C8E9F', nome: 'Mouse Óptico', quantidade: 120, estoqueMinimo: 20 },
        { id: 3, codigo: 'PROD-F4A6G', nome: 'Monitor 27 Polegadas', quantidade: 5, estoqueMinimo: 10 },
    ];
    let nextProductId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
    let history = JSON.parse(localStorage.getItem('history')) || [];
    let categories = JSON.parse(localStorage.getItem('categories')) || [{ id: 1, nome: 'Eletrônicos' }];
    let suppliers = JSON.parse(localStorage.getItem('suppliers')) || [{ id: 1, nome: 'Tech Corp' }];
    let nextCategoryId = categories.length > 0 ? Math.max(...categories.map(c => c.id)) + 1 : 1;
    let nextSupplierId = suppliers.length > 0 ? Math.max(...suppliers.map(s => s.id)) + 1 : 1;

    // --- Funções de Salvar no LocalStorage ---
    function saveProducts() { localStorage.setItem('products', JSON.stringify(products)); }
    function saveHistory() { localStorage.setItem('history', JSON.stringify(history)); }
    function saveCategories() { localStorage.setItem('categories', JSON.stringify(categories)); }
    function saveSuppliers() { localStorage.setItem('suppliers', JSON.stringify(suppliers)); }

    // --- Funções de Renderização e Lógica ---

    function renderProductList(productList = products) {
        const tableBody = document.querySelector('#product-list-table tbody');
        tableBody.innerHTML = '';
        productList.forEach(product => {
            const row = document.createElement('tr');
            const lowStockClass = product.quantidade <= product.estoqueMinimo ? 'low-stock' : '';
            row.innerHTML = `
                <td>${product.id}</td>
                <td>${product.nome}</td>
                <td class="${lowStockClass}">${product.quantidade}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-entrada" onclick="editProduct(${product.id})">Editar</button>
                        <button class="btn-saida btn-excluir" onclick="deleteProduct(${product.id})">Excluir</button>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    function renderHistory() {
        const tableBody = document.getElementById('history-list-body');
        tableBody.innerHTML = '';
        history.reverse().forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.date} ${item.time}</td>
                <td>${item.productName}</td>
                <td>${item.action}</td>
                <td>${item.quantity}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    function renderCategories() {
        const tableBody = document.getElementById('category-list-body');
        tableBody.innerHTML = '';
        categories.forEach(cat => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${cat.id}</td><td>${cat.nome}</td>`;
            tableBody.appendChild(row);
        });
    }

    function renderSuppliers() {
        const tableBody = document.getElementById('supplier-list-body');
        tableBody.innerHTML = '';
        suppliers.forEach(sup => {
            const row = document.createElement('tr');
            row.innerHTML = `<td>${sup.id}</td><td>${sup.nome}</td>`;
            tableBody.appendChild(row);
        });
    }

    function logHistory(action, product, quantity) {
        const now = new Date();
        const date = now.toLocaleDateString();
        const time = now.toLocaleTimeString();
        history.push({
            date,
            time,
            productName: product.nome,
            action: action,
            quantity: quantity
        });
        saveHistory();
    }
    
    // --- Lógica de Eventos e Formulários ---
    
    // Login
    document.getElementById('login-form').addEventListener('submit', function(event) {
        event.preventDefault();
        Swal.fire({
            icon: 'success',
            title: 'Sucesso!',
            text: 'Login realizado com sucesso!',
            showConfirmButton: false,
            timer: 1500
        }).then(() => {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('dashboard-screen').style.display = 'flex';
            // Ativa a aba de produtos como padrão
            document.querySelector('[data-tab="produtos-tab"]').classList.add('active');
            document.getElementById('produtos-tab').classList.add('active');
            renderProductList();
            renderHistory();
            renderCategories();
            renderSuppliers();
        });
    });

    // Navegação por Abas (agora funciona para a barra superior e inferior)
    document.querySelectorAll('.nav-item').forEach(link => {
        link.addEventListener('click', function(event) {
            event.preventDefault();
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(item => item.classList.remove('active'));
            
            const targetTabName = this.getAttribute('data-tab');
            const correspondingNavItems = document.querySelectorAll(`[data-tab="${targetTabName}"]`);
            correspondingNavItems.forEach(item => item.classList.add('active'));

            document.getElementById(targetTabName).classList.add('active');
            
            if (targetTabName === 'historico-tab') renderHistory();
            if (targetTabName === 'categorias-fornecedores-tab') {
                renderCategories();
                renderSuppliers();
            }
        });
    });
    
    // Abrir Pop-ups
    document.getElementById('btn-entrada').addEventListener('click', () => showPopup('entrada-popup'));
    document.getElementById('btn-saida').addEventListener('click', () => showPopup('saida-popup'));

    // Adicionar Produto
    document.getElementById('form-adicionar-produto').addEventListener('submit', function(event) {
        event.preventDefault();
        const nome = document.getElementById('nome-produto').value;
        const estoqueMinimo = parseInt(document.getElementById('estoque-minimo').value);
        const novoProduto = {
            id: nextProductId++,
            codigo: 'PROD-' + Math.random().toString(36).substr(2, 5).toUpperCase(),
            nome: nome,
            quantidade: 0,
            estoqueMinimo: estoqueMinimo
        };
        products.push(novoProduto);
        renderProductList();
        saveProducts();
        logHistory('Adicionado', novoProduto, 0);
        Swal.fire('Adicionado!', 'Produto adicionado com sucesso!', 'success');
        this.reset();
    });

    // Entrada de Produto
    document.getElementById('form-entrada').addEventListener('submit', function(event) {
        event.preventDefault();
        const nome = document.getElementById('produto-entrada').value;
        const quantidade = parseInt(document.getElementById('quantidade-entrada').value);
        const product = products.find(p => p.nome.toLowerCase() === nome.toLowerCase());
        if (product) {
            product.quantidade += quantidade;
            renderProductList();
            saveProducts();
            logHistory('Entrada', product, quantidade);
            Swal.fire('Entrada Confirmada!', `Foram adicionadas ${quantidade} unidades de ${product.nome}.`, 'success');
            hidePopup('entrada-popup');
        } else {
            Swal.fire('Erro!', 'Produto não encontrado.', 'error');
        }
        this.reset();
    });

    // Saída de Produto
    document.getElementById('form-saida').addEventListener('submit', function(event) {
        event.preventDefault();
        const nome = document.getElementById('produto-saida').value;
        const quantidade = parseInt(document.getElementById('quantidade-saida').value);
        const product = products.find(p => p.nome.toLowerCase() === nome.toLowerCase());
        if (product && product.quantidade >= quantidade) {
            product.quantidade -= quantidade;
            renderProductList();
            saveProducts();
            logHistory('Saída', product, quantidade);
            Swal.fire('Saída Confirmada!', `Foram retiradas ${quantidade} unidades de ${product.nome}.`, 'success');
            hidePopup('saida-popup');
        } else if (product && product.quantidade < quantidade) {
            Swal.fire('Erro!', `Quantidade insuficiente em estoque. Disponível: ${product.quantidade}`, 'error');
        } else {
            Swal.fire('Erro!', 'Produto não encontrado.', 'error');
        }
        this.reset();
    });

    // Editar Produto
    function editProduct(productId) {
        const productToEdit = products.find(p => p.id === productId);
        if (productToEdit) {
            document.getElementById('edit-id').value = productToEdit.id;
            document.getElementById('edit-id-display').value = productToEdit.id;
            document.getElementById('edit-codigo-produto').value = productToEdit.codigo;
            document.getElementById('edit-nome-produto').value = productToEdit.nome;
            document.getElementById('edit-quantidade-produto').value = productToEdit.quantidade;
            document.getElementById('edit-estoque-minimo').value = productToEdit.estoqueMinimo;
            showPopup('edicao-popup');
        }
    }
    document.getElementById('form-edicao').addEventListener('submit', function(event) {
        event.preventDefault();
        const id = parseInt(document.getElementById('edit-id').value);
        const nome = document.getElementById('edit-nome-produto').value;
        const quantidade = parseInt(document.getElementById('edit-quantidade-produto').value);
        const estoqueMinimo = parseInt(document.getElementById('edit-estoque-minimo').value);
        
        const productIndex = products.findIndex(p => p.id === id);
        if (productIndex !== -1) {
            const oldProduct = {...products[productIndex]};
            products[productIndex].nome = nome;
            products[productIndex].quantidade = quantidade;
            products[productIndex].estoqueMinimo = estoqueMinimo;
            renderProductList();
            saveProducts();
            logHistory('Editado', products[productIndex], `De: ${oldProduct.quantidade} para: ${quantidade}`);
            Swal.fire('Atualizado!', 'Produto atualizado com sucesso!', 'success');
            hidePopup('edicao-popup');
        }
    });

    // Excluir Produto
    function deleteProduct(productId) {
        Swal.fire({
            title: 'Tem certeza?',
            text: "Você não poderá reverter esta ação!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, excluir!',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                const productToDelete = products.find(p => p.id === productId);
                if (productToDelete) {
                    logHistory('Excluído', productToDelete, productToDelete.quantidade);
                    products = products.filter(p => p.id !== productId);
                    renderProductList();
                    saveProducts();
                    Swal.fire('Excluído!', 'O produto foi excluído com sucesso.', 'success');
                }
            }
        });
    }

    // Busca e Filtro de Produtos
    document.getElementById('search-product').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const filteredProducts = products.filter(p => 
            p.nome.toLowerCase().includes(searchTerm) || 
            p.codigo.toLowerCase().includes(searchTerm)
        );
        renderProductList(filteredProducts);
    });
    document.getElementById('filter-all').addEventListener('click', () => renderProductList(products));
    document.getElementById('filter-low-stock').addEventListener('click', () => {
        const lowStockProducts = products.filter(p => p.quantidade <= p.estoqueMinimo);
        renderProductList(lowStockProducts);
    });

    // Adicionar Categoria
    document.getElementById('form-adicionar-categoria').addEventListener('submit', function(event) {
        event.preventDefault();
        const nome = document.getElementById('nome-categoria').value;
        const novaCategoria = { id: nextCategoryId++, nome: nome };
        categories.push(novaCategoria);
        renderCategories();
        saveCategories();
        Swal.fire('Adicionado!', 'Categoria adicionada com sucesso!', 'success');
        this.reset();
    });

    // Adicionar Fornecedor
    document.getElementById('form-adicionar-fornecedor').addEventListener('submit', function(event) {
        event.preventDefault();
        const nome = document.getElementById('nome-fornecedor').value;
        const novoFornecedor = { id: nextSupplierId++, nome: nome };
        suppliers.push(novoFornecedor);
        renderSuppliers();
        saveSuppliers();
        Swal.fire('Adicionado!', 'Fornecedor adicionado com sucesso!', 'success');
        this.reset();
    });

    // Baixar PDF
    document.getElementById('btn-baixar-pdf').addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Relatório de Estoque - EstoqueSys", 10, 10);
        let y = 20;
        if (products.length === 0) {
            doc.text("Nenhum produto no estoque.", 10, y);
        } else {
            products.forEach((product, index) => {
                doc.text(`ID: ${product.id} - Código: ${product.codigo} - Nome: ${product.nome} - Qtd: ${product.quantidade}`, 10, y);
                y += 10;
            });
        }
        doc.save('relatorio-estoque.pdf');
        Swal.fire('PDF Baixado!', 'Seu relatório de estoque foi salvo com sucesso.', 'success');
        saveProducts();
    });
    
    function showPopup(id) { document.getElementById(id).style.display = 'flex'; }
    function hidePopup(id) { document.getElementById(id).style.display = 'none'; }

    // Lógica dos Gráficos (Chart.js)
    document.addEventListener('DOMContentLoaded', function() {
        renderProductList();
        renderHistory();
        renderCategories();
        renderSuppliers();
        
        const entradaCtx = document.getElementById('entradaChart').getContext('2d');
        const entradaData = {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai'],
            datasets: [{
                label: 'Unidades Entradas',
                data: [120, 150, 80, 200, 180],
                backgroundColor: 'rgba(46, 204, 113, 0.7)',
                borderColor: 'rgba(46, 204, 113, 1)',
                borderWidth: 1
            }]
        };
        new Chart(entradaCtx, { type: 'bar', data: entradaData, options: { responsive: true, scales: { y: { beginAtZero: true } } } });
        const saidaCtx = document.getElementById('saidaChart').getContext('2d');
        const saidaData = {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai'],
            datasets: [{
                label: 'Unidades Saídas',
                data: [90, 110, 100, 170, 130],
                backgroundColor: 'rgba(231, 76, 60, 0.7)',
                borderColor: 'rgba(231, 76, 60, 1)',
                borderWidth: 1
            }]
        };
        new Chart(saidaCtx, { type: 'bar', data: saidaData, options: { responsive: true, scales: { y: { beginAtZero: true } } } });
        const estoqueCtx = document.getElementById('estoqueChart').getContext('2d');
        const estoqueData = {
            labels: products.map(p => p.nome),
            datasets: [{
                label: 'Estoque Atual',
                data: products.map(p => p.quantidade),
                backgroundColor: ['rgba(52, 152, 219, 0.8)', 'rgba(241, 196, 15, 0.8)', 'rgba(149, 165, 166, 0.8)'],
                borderColor: ['rgba(52, 152, 219, 1)', 'rgba(241, 196, 15, 1)', 'rgba(149, 165, 166, 1)'],
                borderWidth: 1
            }]
        };
        new Chart(estoqueCtx, { type: 'pie', data: estoqueData, options: { responsive: true, plugins: { legend: { position: 'top' } } } });
    });
</script>

</body>
</html>
